## Libraries
###########################################################
library(dplyr)
###########################################################
## Load light.nitrogen.datasheet
###########################################################
df <- read.csv("https://raw.githubusercontent.com/eaperkowski/LxN_Greenhouse/main/data_sheets/lightnitrogen.datasheet.csv",
stringsAsFactors = FALSE,
na.strings = c("", "NA"))
###########################################################
## Create whole-plant nitrogen mass (n.acq; gN), root
## carbon mass (root.carbon.mass; gC), and carbon cost to
## acquire nitrogen (n.cost; gC gN-1) metrics.
###########################################################
df <- df %>%
mutate(n.acq = ((stem.wt * (n.stem / 100)) +
(leaves.wt * (n.leaf / 100)) +
(roots.wt * (n.root / 100))),
root.carbon.mass = roots.wt * (c.root / 100),
n.cost = root.carbon.mass / n.acq)
df
# Load libraries
###########################################################
library(lme4)
library(car)
library(emmeans)
###########################################################
# Load data frame produced by "create_ndemand_metrics.R"
###########################################################
source("https://raw.githubusercontent.com/eaperkowski/LxN_Greenhouse/main/R_files/create_ndemand_metrics.R")
###########################################################
# Create categorical fixed effects
###########################################################
df$n.ppm <- as.factor(df$n.ppm)
df$shade.cover <- as.factor(df$shade.cover)
df$spp <- as.factor(df$spp)
###########################################################
# Carbon cost to acquire nitrogen (g C g-1 N)
###########################################################
ncost <- lmer(log(n.cost) ~ spp * shade.cover * n.ppm + (1 | block),
data = df)
# Check normality assumptions
plot(ncost)
qqnorm(residuals(ncost))
qqline(residuals(ncost))
# Model results
summary(ncost)
Anova(ncost)
# Pairwise comparisons
emmeans(ncost, pairwise ~ shade.cover | n.ppm | spp)
emmeans(ncost, pairwise ~ n.ppm | shade.cover | spp)
emmeans(n.acq, pairwise ~ shade.cover | spp)
emmeans(n.acq, pairwise ~ n.ppm | spp)
emmeans(ncost, pairwise ~ spp | n.ppm)
###########################################################
# Whole plant nitrogen mass (g N)
###########################################################
n.acq <- lmer(log(n.acq) ~ spp * shade.cover * n.ppm + (1 | block),
data = df)
# Check normality assumptions
plot(n.acq)
###########################################################
# Whole plant nitrogen mass (g N)
###########################################################
n.acq <- lmer(log(n.acq) ~ spp * shade.cover * n.ppm + (1 | block),
data = df)
emmeans(n.acq, pairwise ~ shade.cover | spp)
# Check normality assumptions
plot(n.acq)
qqnorm(residuals(n.acq))
qqline(residuals(n.acq))
# Model results
summary(n.acq)
Anova(n.acq)
# Pairwise comparisons
emmeans(n.acq, pairwise ~ n.ppm | shade.cover | spp)
emmeans(n.acq, pairwise ~ shade.cover | n.ppm | spp)
emmeans(n.acq, pairwise ~ shade.cover | spp)
emmeans(n.acq, pairwise ~ n.ppm | spp)
###########################################################
# Total root carbon (g C)
###########################################################
root.carbon <- lmer(sqrt(root.carbon.mass) ~ spp * shade.cover * n.ppm +
(1 | block), data = df)
# Check normality assumptions
plot(root.carbon)
qqnorm(residuals(root.carbon))
qqline(residuals(root.carbon))
# Model results
summary(root.carbon)
Anova(root.carbon)
# Pairwise comparisons
emmeans(root.carbon, pairwise ~ n.ppm | shade.cover | spp)
emmeans(root.carbon, pairwise ~ shade.cover | n.ppm | spp)
emmeans(root.carbon, pairwise ~ shade.cover | spp)
emmeans(root.carbon, pairwise ~ n.ppm | spp)
###########################################################
# Root nodule weight
###########################################################
## NOTE: Mixed effect model does not contain species term
## because cotton is not capable of forming root nodules.
## Thus, species comparisons are excluded from this model
soy.df <- subset(df, spp == "Soybean")
soy.df$nod.wt[soy.df$nod.wt == 0] <- NA
nod.wgt <- lmer(log(nod.wt) ~ shade.cover * n.ppm + (1 | block),
data = soy.df)
# Check ormality assumptions
plot(nod.wgt)
qqnorm(residuals(nod.wgt))
qqline(residuals(nod.wgt))
# Model results
summary(nod.wgt)
Anova(nod.wgt)
# Pairwise comparisons
emmeans(nod.wgt, pairwise ~ shade.cover | n.ppm)
emmeans(nod.wgt, pairwise ~ shade.cover)
emmeans(nod.wgt, pairwise ~ n.ppm)
emmeans(nod.wgt, pairwise ~ n.ppm | shade.cover)
###########################################################
## Load libraries
###########################################################
library(tidyverse)
###########################################################
## Load libraries, create species labels, and convert fixed
## effects to factor
###########################################################
source("https://raw.githubusercontent.com/eaperkowski/LxN_Greenhouse/main/R_files/create_ndemand_metrics.R")
species.label <- c("G. max", "G. hirsutum")
names(species.label) <- c("Soybean", "Cotton")
df$spp <- as.factor(df$spp)
df$n.ppm <- as.factor(df$n.ppm)
df$shade.cover <- as.factor(df$shade.cover)
###########################################################
## Add species mean values
###########################################################
# Add species mean columns
df <- df %>% group_by(spp) %>%
mutate(ncost.mean = mean(n.cost, na.rm = TRUE),
n.acq.mean = mean(n.acq, na.rm = TRUE),
root.carbon.mean = mean(root.carbon.mass, na.rm = TRUE))
###########################################################
## Add theme
###########################################################
theme <- theme(panel.background = element_blank(),
strip.background = element_blank(),
strip.text = element_text(size = 14,
face = "italic"),
panel.border = element_rect(size = 2, fill = NA),
axis.text = element_text(size = 14),
axis.title = element_text(size = 14,
face = "bold"),
legend.box.background = element_rect(fill = NA, size = 1),
legend.key = element_rect(fill = NA),
legend.text = element_text(size = 12),
legend.title = element_text(size = 13),
axis.ticks.length = unit(0.25, "cm"))
###########################################################
## Figure 1: Carbon costs to acquire nitrogen (gC gN-1)
###########################################################
ggplot(df, aes(x = shade.cover,
y = n.cost,
fill = n.ppm)) +
geom_hline(aes(yintercept = ncost.mean, group = spp),
linetype = "solid", alpha = 0.8,
color = "red", size = 1) +
geom_boxplot() +
scale_fill_grey(start = 0.4, end = 1.0,
labels = c("0 ppm", "70 ppm",
"210 ppm", "630 ppm")) +
labs(x = "Shade cover (%)",
y = expression(bold("Carbon cost to acquire nitrogen (gC gN"^-1~")")),
fill = "Nitrogen fertilization") +
theme +
facet_grid(~ spp, labeller = labeller(spp = species.label))
###########################################################
## Figure 2: Whole-plant nitrogen mass (gN)
###########################################################
ggplot(df, aes(x = shade.cover,
y = n.acq,
fill = n.ppm)) +
geom_hline(aes(yintercept = n.acq.mean, group = spp),
linetype = "solid", alpha = 0.9,
color = "red", size = 1) +
geom_boxplot() +
scale_fill_grey(start = 0.4, end = 1.0,
labels = c("0 ppm", "70 ppm",
"210 ppm", "630 ppm")) +
scale_y_continuous(limits = c(0, 0.16),
breaks = seq(0, 0.16, 0.04)) +
scale_x_discrete(limits = c("80", "50", "30", "0")) +
labs(x = "Shade cover (%)",
y = "Whole plant nitrogen mass (gN)",
fill = "Nitrogen fertilization") +
theme +
facet_grid(~ spp, labeller = labeller(spp = species.label))
###########################################################
## Figure 3: Root carbon mass (gC)
###########################################################
ggplot(df, aes(x = shade.cover,
y = root.carbon.mass,
fill = n.ppm)) +
geom_hline(aes(yintercept = root.carbon.mean, group = spp),
linetype = "solid", alpha = 0.9,
color = "red", size = 1) +
geom_boxplot() +
scale_fill_grey(start = 0.4, end = 1.0,
labels = c("0 ppm", "70 ppm",
"210 ppm", "630 ppm")) +
scale_y_continuous(limits = c(0, 0.4),
breaks = seq(0, 0.4, 0.1)) +
scale_x_discrete(limits = c("80", "50", "30", "0")) +
labs(x = "Shade cover (%)",
y = "Root carbon mass (gC)",
fill = "Nitrogen fertilization") +
theme +
facet_grid(~ spp, labeller = labeller(spp = species.label))
###########################################################
## Figure 4: Root nodule mass (g)
###########################################################
ggplot(subset(df, spp == "Soybean"),
aes(x = shade.cover,
y = nod.wt,
fill = n.ppm)) +
geom_boxplot() +
scale_fill_grey(start = 0.4, end = 1.0,
labels = c("0 ppm", "70 ppm",
"210 ppm", "630 ppm")) +
scale_x_discrete(limits = c("80", "50", "30", "0")) +
labs(x = "Shade cover (%)",
y = "Root nodule mass (g)",
fill = "Nitrogen fertilization") +
theme
